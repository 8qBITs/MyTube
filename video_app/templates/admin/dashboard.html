{% extends "admin/base_admin.html" %}
{% block title %}Admin Dashboard - {{ site_name or 'MyTube' }}{% endblock %}

{% block admin_content %}
<div class="d-flex align-items-center mb-3">
  <h2 class="mb-0">Dashboard</h2>
</div>

<div class="row mb-4">
  <div class="col-md-4 mb-3">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="me-3">
            <i class="bi bi-film fs-1 text-primary"></i>
          </div>
          <div>
            <div class="text-muted text-uppercase small">Videos</div>
            <div class="fs-4 fw-semibold">{{ video_count }}</div>
          </div>
        </div>
      </div>
      <div class="card-footer bg-transparent border-0 pt-0">
        <a href="{{ url_for('admin.videos') }}" class="small text-decoration-none">
          Manage videos <i class="bi bi-arrow-right-short"></i>
        </a>
      </div>
    </div>
  </div>

  <div class="col-md-4 mb-3">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="me-3">
            <i class="bi bi-people fs-1 text-success"></i>
          </div>
          <div>
            <div class="text-muted text-uppercase small">Users</div>
            <div class="fs-4 fw-semibold">{{ user_count }}</div>
          </div>
        </div>
      </div>
      <div class="card-footer bg-transparent border-0 pt-0">
        <a href="{{ url_for('admin.manage_users') }}" class="small text-decoration-none">
          Manage users <i class="bi bi-arrow-right-short"></i>
        </a>
      </div>
    </div>
  </div>

  <div class="col-md-4 mb-3">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-body">
        <h5 class="card-title mb-3">Settings</h5>
        <form method="post" action="{{ url_for('admin.settings') }}">
          <div class="form-check form-switch mb-3">
            <input class="form-check-input"
                   type="checkbox"
                   id="registration_enabled"
                   name="registration_enabled"
                   {% if registration_enabled %}checked{% endif %}>
            <label class="form-check-label" for="registration_enabled">
              Allow self-registration
            </label>
          </div>

          <div class="mb-3">
            <label for="deepseek_api_key" class="form-label">
              DeepSeek API key
            </label>
            <input type="password"
                   class="form-control"
                   id="deepseek_api_key"
                   name="deepseek_api_key"
                   value="{{ deepseek_api_key or '' }}"
                   autocomplete="off"
                   placeholder="sk-...">
            <div class="form-text">
              Used to auto-generate video titles and descriptions in the admin UI.
            </div>
          </div>

          <div class="mb-3">
            <label for="deepseek_system_prompt" class="form-label">DeepSeek system prompt</label>
            <textarea
              class="form-control"
              id="deepseek_system_prompt"
              name="deepseek_system_prompt"
              rows="3"
              placeholder="System instructions for the AI...">{{ deepseek_system_prompt or '' }}</textarea>
            <div class="form-text">
              This is sent as the <strong>system</strong> message to DeepSeek.
            </div>
          </div>

          <div class="mb-3">
            <label for="deepseek_user_prompt_template" class="form-label">
              DeepSeek user prompt template
            </label>
            <textarea
              class="form-control"
              id="deepseek_user_prompt_template"
              name="deepseek_user_prompt_template"
              rows="6"
              placeholder="Use {filename} where the video file name should be inserted.">{{ deepseek_user_prompt_template or '' }}</textarea>
            <div class="form-text">
              This is the <strong>user</strong> prompt. The placeholder
              <code>{filename}</code> will be replaced with the video file name.
            </div>
          </div>

          <hr class="my-3">

          <div class="mb-3">
            <label for="site_name" class="form-label">Website name</label>
            <input type="text"
                   class="form-control"
                   id="site_name"
                   name="site_name"
                   value="{{ site_name or 'MyTube' }}"
                   placeholder="MyTube">
            <div class="form-text">
              Used in the navbar, page titles, and other branding locations.
            </div>
          </div>

          <div class="mb-3">
            <label for="footer_text" class="form-label">Footer text</label>
            <input type="text"
                   class="form-control"
                   id="footer_text"
                   name="footer_text"
                   value="{{ footer_text or 'Â© MyTube' }}">
            <div class="form-text">
              Shows in the bottom footer of the site.
            </div>
          </div>

          <button type="submit" class="btn btn-primary btn-sm">
            Save Settings
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <!-- Quick actions -->
  <div class="col-md-6 mb-3">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-body">
        <h5 class="card-title mb-3">Quick Actions</h5>
        <div class="d-grid gap-2">
          <a href="{{ url_for('admin.upload_video') }}" class="btn btn-outline-primary">
            <i class="bi bi-upload me-1"></i> Upload Video
          </a>
          <a href="{{ url_for('admin.mass_upload') }}" class="btn btn-outline-secondary">
            <i class="bi bi-collection-play me-1"></i> Mass Upload
          </a>
          <a href="{{ url_for('admin.discover_videos') }}" class="btn btn-outline-secondary">
            <i class="bi bi-search me-1"></i> Discover Existing Files
          </a>
          <a href="{{ url_for('admin.manage_users') }}" class="btn btn-outline-secondary">
            <i class="bi bi-people me-1"></i> Manage Users
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Info / notes -->
  <div class="col-md-6 mb-3">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-body">
        <h5 class="card-title mb-3">Info</h5>
        <p class="mb-2">
          Use the <strong>Videos</strong> page to rename, describe, or delete videos.
        </p>
        <p class="mb-2">
          When a DeepSeek API key is configured, you can click
          <em>AI title &amp; description</em> next to a video or use
          <em>AI fill missing</em> to auto-generate metadata
          based on the file name.
        </p>
        <p class="text-muted small mb-0">
          Branding settings (website name &amp; footer text) apply across the site.
        </p>
      </div>
    </div>
  </div>
</div>
{% endblock %}
